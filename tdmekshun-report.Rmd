---
title: 'HW 1: Анализ и улучшение авиаперевозок'
author: "Мекшун Тихон, tdmekshun"
output: html_document
editor_options: 
  markdown: 
    wrap: 72
---

## Задача

на основе данных (и выданных вопросов) постараться выяснить:

-   какие проблемы есть в авиаперевозках
-   какие улучшения можно предложить на основе выводов по данным

#### Загрузка данных и преобразование

```{r echo = F, warning=FALSE, message=FALSE}
library(dplyr)
library(ggplot2)

source("~/shared/minor2_2022/1-Intro/hw1/hw1_data.R")

airline = hw1_get_data(df_name = "airline")
airport = hw1_get_data(df_name = "airport")
lounge = hw1_get_data(df_name = "lounge")
seat = hw1_get_data(df_name = "seat")



hw1_get_questions()
```

### Вопросы

#### Вопрос 1

**Вопрос:** Какие типы путешественников (type_traveller) поставили самые
низкие оценки по критерию оценок за обслуживание в аэропорте (airport
staff)?

**Данные:** для ответа на вопрос нужны таблицы airport

```{r echo = F, warning=FALSE, message=FALSE}
airport_type_rating = airport %>% filter(!is.na(type_traveller)) %>% filter(!is.na(airport_staff_rating)) 
airport_type_rating[c('type_traveller','airport_staff_rating')]

ggplot(data=airport) + geom_bar(aes(x=type_traveller, fill=type_traveller)) + xlab('Traveller Type') + labs(title = 'Колличество типов путешественников', subtitle = 'в датасете airport')
```

**Ответ:** Solo Leisure, Family Leisure

**Вывод:** Основываясь на данных, меньше всего обслуживанием в аэропорте
довольны пассажиры типа: Solo Leisure, Family Leisure. Однако, данный
вывод сделан на 3 оценках известных типов пассажиров с известной оценкой
за обслуживание в аэропорте, поэтому вывод может не отражать реальной
картины. Как показывает столбчатый график, в датасете airport больше
неизвестных типов путешественников, а известных - очень мало. Чтобы
оценить какой тип меньше всего доволен обслуживанием в аэропорте нужно
вписать большее данных о типе путешественника в датасет airport. А на
основе имеющихся данных можно узнать у самой недовольной части как можно
улучшить обслуживание аэропорта.

#### Вопрос 2

**Вопрос:** Где доля полётов в экономе выше -- в BOEING или в AIRBUS?

**Данные:** для ответа на вопрос нужны таблицы seat

```{r echo = F, warning=FALSE, message=FALSE}
library(stringr)
fraction_flight = seat %>% filter(cabin_flown == 'Economy') 
all_flight = as.integer(148)
fraction_flight$aircraft = fraction_flight$aircraft %>% str_to_lower() %>% str_extract('boeing|airbus')
fraction_flight_table = fraction_flight %>% filter(!is.na(aircraft)) %>% group_by(aircraft) %>% summarise(counts=n(), fraction = round((n()*100/all_flight),2))
head(fraction_flight_table)


fraction_flight_graph = fraction_flight %>% filter(!is.na(aircraft))
ggplot(data = fraction_flight_graph) + geom_bar(aes(x=aircraft, fill=aircraft)) + xlab('Plane') + ylab('Flights by econom') + labs(title = 'Колличество билетов на эконом.класс', subtitle = 'на airbus и boeing')

ggplot(data = seat) + geom_bar(aes(x=cabin_flown, fill = cabin_flown )) + xlab('Class') + ylab('Flights') + labs(title = 'Колличество билетов на определенный класс', subtitle = 'на всех самолетах')

ggplot(data = seat) + geom_bar(mapping = aes(x=aircraft,fill = cabin_flown)) +theme(axis.text.x=element_text(angle=45))+ coord_flip() + labs(title = 'На какой самолёт/самолёты чаще всего покупают билет') + theme(text = element_text(size=5))

ecomom_top = seat %>% filter(cabin_flown == 'Economy') %>% group_by(aircraft) %>% summarise(count_ticket = n()) %>% arrange(-count_ticket)
ecomom_top

```

**Ответ:** BOEING

**Вывод:**  Можно сделать вывод о том, что на самолёты модели Boeing
чаще покупают билеты в эконом.класс, чем на самолёты модели airbus.
Более того, второй график показывает, что эконом.класс - это самый
популярный выбор вообще. Более того, как показывает последний график,
чаще всего люди летают на самолёте boeing 777-300ER, в котором одна из
самых больших долей пассажиров эконом.класса, так и самая большая доля
премиум.эконома. А самолёты куда покупают чаще всего билеты
эконом.класса это: A340, A380, BOEING 777 и BOEING 777-300ER (лидер по
колличеству билетов в принципе). Что касается практических методов, то
нужно вспомнить, что не человек полностью решает на какой модели
самолёта ему лететь, а авиакомпания у которой есть купленные самолёты.
Значит, можно построить теорию о том, что A340, A380, BOEING 777 и
BOEING 777-300ER -- самые популярные купленные модели у авиакомпаний и
попытаться узнать почему: дело в цене или, например, дело в обслуживании
самолёта. Например, если заказчик - будущая авиакомпания, то можно
представить эти данные, чтобы они определились с покупкой оптимального
варианта.

### Вопрос 3

**Вопрос:** Какие аэропорты рекомендуют чаще, те, в которых есть лаунжи
бизнесс-класса, или те, в которых их нет?

**Данные:** для ответа на вопрос нужны таблицы lounge, airport

```{r echo = F, warning=FALSE, message=FALSE}
airport_rate = airport
airport_rate$airport_name = str_replace_all(airport_rate$airport_name, '-', ' ')
lounge_rate = lounge
lounge_rate$airport=str_to_lower(lounge_rate$airport)
names(airport_rate)[names(airport_rate) == 'airport_name'] = 'airport'
lounge_rate = filter(lounge_rate, !is.na(airport))
airport_rate = filter(airport_rate, !is.na(airport))
common_rate= inner_join(airport_rate,lounge_rate,by= 'airport')
common_rate = common_rate[c('airport', 'recommended.x', 'lounge_type')]
common_rate = common_rate %>% filter(!is.na(lounge_type)) %>% group_by(airport, lounge_type) %>% summarise(counter=sum(recommended.x)) %>% arrange(-counter)

ggplot(data=common_rate) + geom_col(aes(x=lounge_type, y=counter, fill = lounge_type)) + xlab('Тип лаунжа') + ylab('Колличество рекоменаций аэропорта') + labs(title='Зависимость колличества рекомендаций аэропорта',subtitle='от типа лаунжа')
first_class = lounge %>%  filter(lounge_type == 'First Class') %>% group_by(airport) %>% summarise(count_rec = sum(recommended)) %>% arrange(-count_rec)
business_class = lounge %>%  filter(lounge_type == 'Business Class') %>% group_by(airport) %>% summarise(count_rec = sum(recommended)) %>% arrange(-count_rec)
head(first_class)
head(business_class)

```

**Ответ:** В которых лаунж бизнесс-класса есть.

**Вывод:** Люди охотнее рекомендуют аэропорты с лаунжем бизнесс-класса,
чем аэропорты без него. Получается лаунж бинесс-класса влияет на общее
впечатления и дальнейшего пребывания в аэропорту. Соответвенно, если
заказчик - потенциальный аэропорт, то можно порекомендовать ему, на
основе данных, сделать в первую очередь лаунж бизнесс-класса, а не
первого класса или не делать его вовсе. А существующим аэропортам можно
посоветовать улучшить сервис первого класса. Две последние таблицы
показывают колличество рекомендаций бизнес и первого класса. Значит,
пассажиров может что-то не устраивать в лаунже первого класса или можно
выяснить причину непопулярности первого класса. Так же, стоит отметить,
что Heathrow является лидером в обоих сравнениях, значит можно изучить
его, например, в качестве анализа конкурента.

### Дэшборд

Полученные выводы обобщены в виде дэшборда со следующими элементами

**Элемент 1:** - вид: Таблица - ответ на вопрос: 1 - обоснование: в
данном случае обычная частотная таблица наглядно показывает тип
путешественника и его оценки за обслуживание. Наглядный и простой способ
визуализации. Данная таблица даёт легко понять какой тип, какую оценку
поставил.

**Элемент 2:** - вид: график - ответ на вопрос: 1 - обоснование: в
данном случае я хотел сконцентрировать внимание на проблему недостатка
данных, столбчатая диаграмма наглядно показывает колличество тех или
иных типо путешественников в таблице. Самая высокое значение наглядно
показывает недостаток данных, ведь дело не в том, что много пропущенных
значений, но в том, что данных в принципе мало.

**Элемент 3:** - вид: таблица - ответ на вопрос: 2 - обоснование: в
данном случае таблица показывает колличество перевозок на самолётах
модели airbus и boeing, а так же их процент по отношению ко всем полётам
в датасете. Использовал таблицу для наглядной визуализации данных, где
видно как и колличество, так и процент, дабы избежать путанницы и не
вводить в заблуждение, например, когда полётов мало, процент становится
больше и не отображает реальной картины. За основу был взять датасет
seat, дело в том, что если есть отзыв на сидение в самолёте, значит
пользователь в нем был и он на нем летал.

**Элемент 4:** - вид: график - ответ на вопрос: 3 - обоснование: Я
выбрал график для того, чтобы показать лаунж какого класса принесёт
больше всего рекомендаций для аэропорта в целом, а не только
рекомендации за сам лаунж. Иначе говоря, этот график показывает, что
больше всего рекомендаций аэропорта от пользователей приносит лаунж
именно бизнесс-класса, а не иные. Вместо таблицы, которая тоже будет
понятной, график выглядит более выигрышным за счёт того, что он больше
показывает разницу и лидерство лаунжей бизнесс-класса, а так же
"нестостоятельность" frequent flyer. Стоит так же отметить, что
некоторые аэропорты имеют несколько лаунжей.

### Общие выводы

Что касается улучшения авиаперевозок и общих выводов.

а)Наблюдение в первом вопросе говорит о том, что наблюдений для
улучшения сервиса обслуживание аэропорта недостаточно. Можно попытаться
вяснить, почему люди не ставят оценки качеству обслуживание аэропорта
и/или почему они не указывают свой тип.

б)Наблюдения во втором вопросе говорят о том, что чаще всего люди
предпочитают летать в эконом.классе, данное знание поможет улучшить
сервис эконом.класса и получить лояльность клиентов, а так же начать
работу над улучшением остальных премиальных классов. Можно попытаться
узнать почему люди не покупают место премиум эконома, может их что-то не
устраивает, например, цена или качество, а может и недостаток
преимуществ над экономом. Молодым авиакомпаниям можно посоветовать брать
боинг определенной модели как самый оптимальный и надежный вариант,
иначе бы на нем не совершались большинство перелетов.

в)Наблюдения в третьем вопросе даёт знание о том, что, чем лучше лаунж
бизнесс-класса, тем больше шанс рекомендации аэропорта, так же, что не
мало важно хороший лаунж -- повышает впечатление от всего
времяпрепровождения в аэропорту. Также, можно заняться анализом лаунжа
heathrow airport, как самый рекомендованный лаунж и аэропорт, чтобы
понять его особенность и почеп=му люди его рекомендуют.
